{"version":3,"sources":["../src/provider.js"],"names":["Events","require","Provider","constructor","powTarget","maxMessageSize","events","notificationCallbacks","send","payload","callback","sendAsync","console","log","method","bind","call","err","result","response","id","Error","shh_version","cb","shh_info","shh_setMaxMessageSize","params","shh_setMinPoW","shh_newKeyPair","emit","shh_addPrivateKey","shh_deleteKeyPair","shh_hasKeyPair","shh_getPublicKey","shh_getPrivateKey","admin_addPeer","shhext_requestMessages","shh_newSymKey","shh_addSymKey","shh_generateSymKeyFromPassword","shh_hasSymKey","shh_getSymKey","shh_deleteSymKey","shh_subscribe","shh_unsubscribe","_payload","_cb","shh_newMessageFilter","shh_markTrustedPeer","shh_deleteMessageFilter","shh_getFilterMessages","shh_post","on","type","push","transmit","forEach","module","exports"],"mappings":"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","sourcesContent":["const Events = require('events');\n\nclass Provider {\n\n  constructor() {\n    this.powTarget = 12.5;\n    this.maxMessageSize = 2000;\n    this.events = new Events();\n    this.notificationCallbacks = [];\n  }\n\n  send(payload, callback) {\n    return this.sendAsync(payload, callback);\n  }\n\n  sendAsync(payload, callback) {\n    console.log('payload method is ', payload.method);\n\n    let method = this[payload.method].bind(this);\n    if (method) {\n      return method.call(method, payload, (err, result) => {\n        if (err) {\n          return callback(err);\n        }\n        let response = {'id': payload.id, 'jsonrpc': '2.0', 'result': result};\n        callback(null, response);\n      });\n    }\n    callback(new Error('unknown method ' + payload.method));\n  }\n\n  shh_version(payload, cb) {\n    cb(null, \"6.0\");\n  }\n\n  shh_info(payload, cb) {\n    let result = {\n      \"minPow\": this.powTarget,\n      \"maxMessageSize\": this.maxMessageSize,\n      \"memory\": 10000,\n      \"messages\": 20,\n    };\n\n    cb(null, result);\n  }\n\n  shh_setMaxMessageSize(payload, cb) {\n    this.maxMessageSize = payload.params[0];\n\n    cb(null, true);\n  }\n\n  shh_setMinPoW(payload, cb) {\n    this.powTarget = payload.params[0];\n\n    cb(null, true);\n  }\n\n  shh_newKeyPair(payload, cb) {\n    this.events.emit('newKeyPair', cb);\n  }\n\n  shh_addPrivateKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"private key is required\");\n    }\n\n    this.events.emit('addPrivateKey', payload.params[0], cb);\n  }\n\n  shh_deleteKeyPair(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('deleteKeyPair', payload.params[0], cb);\n  }\n\n  shh_hasKeyPair(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('hasKeyPair', payload.params[0], cb);\n  }\n\n  shh_getPublicKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('getPublicKey', payload.params[0], cb);\n  }\n\n  shh_getPrivateKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('getPrivateKey', payload.params[0], cb);\n  }\n\n  admin_addPeer(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"enode URL is required\");\n    }\n    this.events.emit('addPeer', payload.params[0], cb);\n  }\n\n  shhext_requestMessages(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"message request object\");\n    }\n    this.events.emit('requestMessages', this.powTarget, payload.params[0], cb);\n  }\n\n  shh_newSymKey(payload, cb) {\n    this.events.emit('newSymKey', cb);\n  }\n\n  shh_addSymKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"symmetric key is required\");\n    }\n\n    this.events.emit('addSymKey', payload.params[0], cb);\n  }\n\n  shh_generateSymKeyFromPassword(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"password is required\");\n    }\n\n    this.events.emit('generateSymKeyFromPassword', payload.params[0], cb);\n  }\n\n  shh_hasSymKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('hasSymKey', payload.params[0], cb);\n  }\n\n  shh_getSymKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('getSymKey', payload.params[0], cb);\n  }\n\n  shh_deleteSymKey(payload, cb) {\n    if (!payload.params[0]) {\n      return cb(\"key id is required\");\n    }\n\n    this.events.emit('deleteSymKey', payload.params[0], cb);\n  }\n\n  shh_subscribe(payload, cb) {\n    if (payload.params[0] !== \"messages\") {\n      return cb(\"unknonw payload type \"+ payload.params[0]);\n    }\n    this.events.emit('subscribe', payload.params[1], cb);\n  }\n\n  shh_unsubscribe(_payload, _cb) {\n    throw new Error(\"shh_unsubscribe not implemented yet\");\n    // cb(null, false);\n  }\n\n  shh_newMessageFilter(_payload, _cb) {\n    throw new Error(\"shh_newMessageFilter not implemented yet\");\n    // cb(null, false);\n  }\n\n  shh_markTrustedPeer(payload, cb){\n    this.events.emit('markTrustedPeer', payload.params[0]);\n    cb(null, true);\n  }\n\n  shh_deleteMessageFilter(_payload, _cb) {\n    throw new Error(\"shh_deleteMessageFilter not implemented yet\");\n    // cb(null, false);\n  }\n\n  shh_getFilterMessages(_payload, _cb) {\n    throw new Error(\"shh_getFilterMessages not implemented yet\");\n    // cb(null, false);\n  }\n\n  shh_post(payload, cb) {\n    this.events.emit('post', payload.params[0], cb);\n  }\n\n  on(type, cb) {\n    // TODO: support other types later, if relevant\n    if (type !== 'data') return;\n    this.notificationCallbacks.push(cb);\n  }\n\n  transmit(result) {\n    this.notificationCallbacks.forEach((callback) => {\n      callback(result);\n    });\n  }\n\n}\n\nmodule.exports = Provider;\n"],"file":"provider.js"}